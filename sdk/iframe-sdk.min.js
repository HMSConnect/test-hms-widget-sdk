var me=null,domain=null;function isMe(e){return e.getAttribute("src").includes("hms-widget-sdk")}for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;++i)if(isMe(scripts[i])){const e=(me=scripts[i]).getAttribute("src").split("/");e.pop(),domain=e.join("/")}var loadJsFile=function(e,t){let i=document.createElement("script");i.src=e,i.onload=function(){t&&t()},i.type="text/javascript",i.async=!1,i.defer=!1;const s=document.getElementsByTagName("script")[0];s.parentNode&&s.parentNode.insertBefore(i,s)};class MessageListenerServiceFactory{register=[];origin;extendMessageListener=null;registerMessage(e,t){this.register.push({iframeName:e,listener:t})}initialMessageListener(){window.addEventListener("message",e=>{if((!this.origin||e.origin===this.origin)&&"embedded-widget"===e.data.eventType){const t=e.data.iframeName,i=this.register.find(e=>e.iframeName===t);i&&i.listener(e.data),this.extendMessageListener&&this.extendMessageListener()}})}addExtendMessagelistener(e){this.extendMessageListener=e}setOrigin(e){this.origin=e}}var messageListenerService=new MessageListenerServiceFactory;window.messageListenerService=messageListenerService,messageListenerService.initialMessageListener();class HmsWidgetFactory{iframeObject={src:"",qs:"",name:"",selector:"",iframeElement:void 0,theme:void 0,customTheme:void 0,width:"300px",height:"300px",href:"https://hms-widget.bonmek.com",pathPrefix:"embedded-widget",isFirstRender:!0,structure:{}};init=e=>{const t=document.getElementById(e.selector);this.iframeObject.selector=e.selector,this.iframeObject.name=e.name,this.iframeObject.iframeElement=document.createElement("iframe"),this.iframeObject.iframeElement.setAttribute("width",e.width||this.iframeObject.width),this.iframeObject.iframeElement.setAttribute("height",e.height||this.iframeObject.height),e.href&&(this.iframeObject.href=e.href),e.pathPrefix&&(this.iframeObject.pathPrefix=e.pathPrefix),this.iframeObject.src=`${this.iframeObject.href}/${this.iframeObject.pathPrefix}/${e.widgetPath}`,t.appendChild(this.iframeObject.iframeElement)};setParams=e=>{const t=queryStringify({...e,isWaitForIframeLoaded:!0});this.iframeObject.qs=t,this.iframeObject.isFirstRender||this.render()};setTheme=e=>{this.iframeObject.theme=e,this.iframeObject.isFirstRender||this.render()};setCustomizeTheme=(e,t)=>{this.iframeObject.customTheme={themeObject:e,themeName:t},this.iframeObject.isFirstRender||this.render()};setStructure=e=>{this.iframeObject.structure={...this.iframeObject.structure,...e},this.iframeObject.isFirstRender||this.render()};render=e=>{e&&e();try{this.iframeObject.iframeElement.onload=()=>this.onIframeLoaded(this.iframeObject);const e=`${this.iframeObject.src}${this.iframeObject.qs?`?${this.iframeObject.qs}`:""}`;console.info("this.iframeObject.src :",`${this.iframeObject.src}${this.iframeObject.qs?`?${this.iframeObject.qs}`:""}`),this.iframeObject.iframeElement.setAttribute("src",`${e}`),this.iframeObject.isFirstRender=!1}catch(e){console.error("error: ",e)}};onIframeLoaded=e=>{const t=createMessageEvents(e.iframeElement,["finishIframeLoading","setTheme","setCustomTheme","setIframeName","setStructure"]);t.setIframeName(e.selector),e.theme&&t.setTheme(e.theme),e.customTheme&&t.setCustomTheme(e.customTheme),t.setStructure(this.iframeObject.structure),t.finishIframeLoading()};onMessage=e=>{messageListenerService.registerMessage(this.iframeObject.selector,e)}}window.hmsWidgetAsyncInit=function(e){const t=new HmsWidgetFactory;return loadJsFile(`${domain}/message-utils.min.js`),loadJsFile(`${domain}/stringify.min.js`,()=>{t.render((function(){e(t)}))}),t};